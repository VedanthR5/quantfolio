<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="generator" content="quarto-1.8.26" />

    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, user-scalable=yes"
    />

    <title>
      ARIMA Time Series Forecasting for Stock Prices – VR Quantfolio
    </title>
    <style>
      code {
        white-space: pre-wrap;
      }
      span.smallcaps {
        font-variant: small-caps;
      }
      div.columns {
        display: flex;
        gap: min(4vw, 1.5em);
      }
      div.column {
        flex: auto;
        overflow-x: auto;
      }
      div.hanging-indent {
        margin-left: 1.5em;
        text-indent: -1.5em;
      }
      ul.task-list {
        list-style: none;
      }
      ul.task-list li input[type="checkbox"] {
        width: 0.8em;
        margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */
        vertical-align: middle;
      }
      /* CSS for syntax highlighting */
      html {
        -webkit-text-size-adjust: 100%;
      }
      pre > code.sourceCode {
        white-space: pre;
        position: relative;
      }
      pre > code.sourceCode > span {
        display: inline-block;
        line-height: 1.25;
      }
      pre > code.sourceCode > span:empty {
        height: 1.2em;
      }
      .sourceCode {
        overflow: visible;
      }
      code.sourceCode > span {
        color: inherit;
        text-decoration: inherit;
      }
      div.sourceCode {
        margin: 1em 0;
      }
      pre.sourceCode {
        margin: 0;
      }
      @media screen {
        div.sourceCode {
          overflow: auto;
        }
      }
      @media print {
        pre > code.sourceCode {
          white-space: pre-wrap;
        }
        pre > code.sourceCode > span {
          text-indent: -5em;
          padding-left: 5em;
        }
      }
      pre.numberSource code {
        counter-reset: source-line 0;
      }
      pre.numberSource code > span {
        position: relative;
        left: -4em;
        counter-increment: source-line;
      }
      pre.numberSource code > span > a:first-child::before {
        content: counter(source-line);
        position: relative;
        left: -1em;
        text-align: right;
        vertical-align: baseline;
        border: none;
        display: inline-block;
        -webkit-touch-callout: none;
        -webkit-user-select: none;
        -khtml-user-select: none;
        -moz-user-select: none;
        -ms-user-select: none;
        user-select: none;
        padding: 0 4px;
        width: 4em;
      }
      pre.numberSource {
        margin-left: 3em;
        padding-left: 4px;
      }
      div.sourceCode {
      }
      @media screen {
        pre > code.sourceCode > span > a:first-child::before {
          text-decoration: underline;
        }
      }
    </style>

    <script src="../site_libs/quarto-nav/quarto-nav.js"></script>
    <script src="../site_libs/quarto-nav/headroom.min.js"></script>
    <script src="../site_libs/clipboard/clipboard.min.js"></script>
    <script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
    <script src="../site_libs/quarto-search/fuse.min.js"></script>
    <script src="../site_libs/quarto-search/quarto-search.js"></script>
    <meta name="quarto:offset" content="../" />
    <script src="../site_libs/quarto-html/quarto.js" type="module"></script>
    <script
      src="../site_libs/quarto-html/tabsets/tabsets.js"
      type="module"
    ></script>
    <script
      src="../site_libs/quarto-html/axe/axe-check.js"
      type="module"
    ></script>
    <script src="../site_libs/quarto-html/popper.min.js"></script>
    <script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
    <script src="../site_libs/quarto-html/anchor.min.js"></script>
    <link href="../site_libs/quarto-html/tippy.css" rel="stylesheet" />
    <link
      href="../site_libs/quarto-html/quarto-syntax-highlighting-597958c53c93a607afca12fd375c57ed.css"
      rel="stylesheet"
      class="quarto-color-scheme"
      id="quarto-text-highlighting-styles"
    />
    <link
      href="../site_libs/quarto-html/quarto-syntax-highlighting-dark-7ac2f9da8c2617a4fdd15004b4601015.css"
      rel="stylesheet"
      class="quarto-color-scheme quarto-color-alternate"
      id="quarto-text-highlighting-styles"
    />
    <script src="../site_libs/bootstrap/bootstrap.min.js"></script>
    <link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet" />
    <link
      href="../site_libs/bootstrap/bootstrap-ea2c01f27a86cd888be845a75ab84aaf.min.css"
      rel="stylesheet"
      append-hash="true"
      class="quarto-color-scheme"
      id="quarto-bootstrap"
      data-mode="light"
    />
    <link
      href="../site_libs/bootstrap/bootstrap-dark-78d0a13e6d35108d84457cbe65748f29.min.css"
      rel="stylesheet"
      append-hash="true"
      class="quarto-color-scheme quarto-color-alternate"
      id="quarto-bootstrap"
      data-mode="dark"
    />
    <script id="quarto-search-options" type="application/json">
      {
        "location": "navbar",
        "copy-button": false,
        "collapse-after": 3,
        "panel-placement": "end",
        "type": "overlay",
        "limit": 50,
        "keyboard-shortcut": ["f", "/", "s"],
        "show-item-context": false,
        "language": {
          "search-no-results-text": "No results",
          "search-matching-documents-text": "matching documents",
          "search-copy-link-title": "Copy link to search",
          "search-hide-matches-text": "Hide additional matches",
          "search-more-match-text": "more match in this document",
          "search-more-matches-text": "more matches in this document",
          "search-clear-button-title": "Clear",
          "search-text-placeholder": "",
          "search-detached-cancel-button-title": "Cancel",
          "search-submit-button-title": "Submit",
          "search-label": "Search"
        }
      }
    </script>

    <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
    <script
      src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js"
      type="text/javascript"
    ></script>

    <script type="text/javascript">
      const typesetMath = (el) => {
        if (window.MathJax) {
          // MathJax Typeset
          window.MathJax.typeset([el]);
        } else if (window.katex) {
          // KaTeX Render
          var mathElements = el.getElementsByClassName("math");
          var macros = [];
          for (var i = 0; i < mathElements.length; i++) {
            var texText = mathElements[i].firstChild;
            if (mathElements[i].tagName == "SPAN" && texText && texText.data) {
              window.katex.render(texText.data, mathElements[i], {
                displayMode: mathElements[i].classList.contains("display"),
                throwOnError: false,
                macros: macros,
                fleqn: false,
              });
            }
          }
        }
      };
      window.Quarto = {
        typesetMath,
      };
    </script>
  </head>

  <body class="nav-fixed quarto-dark">
    <script id="quarto-html-before-body" type="application/javascript">
      const toggleBodyColorMode = (bsSheetEl) => {
        const mode = bsSheetEl.getAttribute("data-mode");
        const bodyEl = window.document.querySelector("body");
        if (mode === "dark") {
          bodyEl.classList.add("quarto-dark");
          bodyEl.classList.remove("quarto-light");
        } else {
          bodyEl.classList.add("quarto-light");
          bodyEl.classList.remove("quarto-dark");
        }
      };
      const toggleBodyColorPrimary = () => {
        const bsSheetEl = window.document.querySelector(
          "link#quarto-bootstrap:not([rel=disabled-stylesheet])"
        );
        if (bsSheetEl) {
          toggleBodyColorMode(bsSheetEl);
        }
      };
      const setColorSchemeToggle = (alternate) => {
        const toggles = window.document.querySelectorAll(
          ".quarto-color-scheme-toggle"
        );
        for (let i = 0; i < toggles.length; i++) {
          const toggle = toggles[i];
          if (toggle) {
            if (alternate) {
              toggle.classList.add("alternate");
            } else {
              toggle.classList.remove("alternate");
            }
          }
        }
      };
      const toggleColorMode = (alternate) => {
        // Switch the stylesheets
        const primaryStylesheets = window.document.querySelectorAll(
          "link.quarto-color-scheme:not(.quarto-color-alternate)"
        );
        const alternateStylesheets = window.document.querySelectorAll(
          "link.quarto-color-scheme.quarto-color-alternate"
        );
        manageTransitions("#quarto-margin-sidebar .nav-link", false);
        if (alternate) {
          // note: dark is layered on light, we don't disable primary!
          enableStylesheet(alternateStylesheets);
          for (const sheetNode of alternateStylesheets) {
            if (sheetNode.id === "quarto-bootstrap") {
              toggleBodyColorMode(sheetNode);
            }
          }
        } else {
          disableStylesheet(alternateStylesheets);
          enableStylesheet(primaryStylesheets);
          toggleBodyColorPrimary();
        }
        manageTransitions("#quarto-margin-sidebar .nav-link", true);
        // Switch the toggles
        setColorSchemeToggle(alternate);
        // Hack to workaround the fact that safari doesn't
        // properly recolor the scrollbar when toggling (#1455)
        if (
          navigator.userAgent.indexOf("Safari") > 0 &&
          navigator.userAgent.indexOf("Chrome") == -1
        ) {
          manageTransitions("body", false);
          window.scrollTo(0, 1);
          setTimeout(() => {
            window.scrollTo(0, 0);
            manageTransitions("body", true);
          }, 40);
        }
      };
      const disableStylesheet = (stylesheets) => {
        for (let i = 0; i < stylesheets.length; i++) {
          const stylesheet = stylesheets[i];
          stylesheet.rel = "disabled-stylesheet";
        }
      };
      const enableStylesheet = (stylesheets) => {
        for (let i = 0; i < stylesheets.length; i++) {
          const stylesheet = stylesheets[i];
          if (stylesheet.rel !== "stylesheet") {
            // for Chrome, which will still FOUC without this check
            stylesheet.rel = "stylesheet";
          }
        }
      };
      const manageTransitions = (selector, allowTransitions) => {
        const els = window.document.querySelectorAll(selector);
        for (let i = 0; i < els.length; i++) {
          const el = els[i];
          if (allowTransitions) {
            el.classList.remove("notransition");
          } else {
            el.classList.add("notransition");
          }
        }
      };
      const isFileUrl = () => {
        return window.location.protocol === "file:";
      };
      const hasAlternateSentinel = () => {
        let styleSentinel = getColorSchemeSentinel();
        if (styleSentinel !== null) {
          return styleSentinel === "alternate";
        } else {
          return false;
        }
      };
      const setStyleSentinel = (alternate) => {
        const value = alternate ? "alternate" : "default";
        if (!isFileUrl()) {
          window.localStorage.setItem("quarto-color-scheme", value);
        } else {
          localAlternateSentinel = value;
        }
      };
      const getColorSchemeSentinel = () => {
        if (!isFileUrl()) {
          const storageValue = window.localStorage.getItem(
            "quarto-color-scheme"
          );
          return storageValue != null ? storageValue : localAlternateSentinel;
        } else {
          return localAlternateSentinel;
        }
      };
      const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
        const baseTheme =
          document.querySelector("#giscus-base-theme")?.value ?? "light";
        const alternateTheme =
          document.querySelector("#giscus-alt-theme")?.value ?? "dark";
        let newTheme = "";
        if (authorPrefersDark) {
          newTheme = isAlternate ? baseTheme : alternateTheme;
        } else {
          newTheme = isAlternate ? alternateTheme : baseTheme;
        }
        const changeGiscusTheme = () => {
          // From: https://github.com/giscus/giscus/issues/336
          const sendMessage = (message) => {
            const iframe = document.querySelector("iframe.giscus-frame");
            if (!iframe) return;
            iframe.contentWindow.postMessage(
              { giscus: message },
              "https://giscus.app"
            );
          };
          sendMessage({
            setConfig: {
              theme: newTheme,
            },
          });
        };
        const isGiscussLoaded =
          window.document.querySelector("iframe.giscus-frame") !== null;
        if (isGiscussLoaded) {
          changeGiscusTheme();
        }
      };
      const authorPrefersDark = true;
      const darkModeDefault = authorPrefersDark;
      let localAlternateSentinel = darkModeDefault ? "alternate" : "default";
      // Dark / light mode switch
      window.quartoToggleColorScheme = () => {
        // Read the current dark / light value
        let toAlternate = !hasAlternateSentinel();
        toggleColorMode(toAlternate);
        setStyleSentinel(toAlternate);
        toggleGiscusIfUsed(toAlternate, darkModeDefault);
        window.dispatchEvent(new Event("resize"));
      };
      // Switch to dark mode if need be
      if (hasAlternateSentinel()) {
        toggleColorMode(true);
      } else {
        toggleColorMode(false);
      }
    </script>

    <div id="quarto-search-results"></div>
    <header id="quarto-header" class="headroom fixed-top">
      <nav class="navbar navbar-expand-lg" data-bs-theme="dark">
        <div class="navbar-container container-fluid">
          <div class="navbar-brand-container mx-auto">
            <a class="navbar-brand" href="../index.html">
              <span class="navbar-title">VR Quantfolio</span>
            </a>
          </div>
          <div id="quarto-search" class="" title="Search"></div>
          <button
            class="navbar-toggler"
            type="button"
            data-bs-toggle="collapse"
            data-bs-target="#navbarCollapse"
            aria-controls="navbarCollapse"
            role="menu"
            aria-expanded="false"
            aria-label="Toggle navigation"
            onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }"
          >
            <span class="navbar-toggler-icon"></span>
          </button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
              <li class="nav-item">
                <a class="nav-link" href="../index.html">
                  <span class="menu-text">Home</span></a
                >
              </li>
              <li class="nav-item">
                <a
                  class="nav-link active"
                  href="../tutorials/arima_fundamentals.html"
                  aria-current="page"
                >
                  <span class="menu-text">ARIMA Tutorial</span></a
                >
              </li>
            </ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
              <li class="nav-item compact">
                <a
                  class="nav-link"
                  href="https://github.com/vedanthr5/vr-quantfolio-intro"
                >
                  <i class="bi bi-github" role="img"> </i>
                  <span class="menu-text"></span
                ></a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="https://vrquantfolio.streamlit.app">
                  <i class="bi bi-rocket" role="img"> </i>
                  <span class="menu-text">Live App</span></a
                >
              </li>
            </ul>
          </div>
          <!-- /navcollapse -->
          <div class="quarto-navbar-tools">
            <a
              href=""
              class="quarto-color-scheme-toggle quarto-navigation-tool px-1"
              onclick="window.quartoToggleColorScheme(); return false;"
              title="Toggle dark mode"
              ><i class="bi"></i
            ></a>
          </div>
        </div>
        <!-- /container-fluid -->
      </nav>
    </header>
    <!-- content -->
    <div
      id="quarto-content"
      class="quarto-container page-columns page-rows-contents page-layout-article page-navbar"
    >
      <!-- sidebar -->
      <!-- margin-sidebar -->
      <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
          <h2 id="toc-title">On this page</h2>

          <ul>
            <li>
              <a
                href="#what-is-arima"
                id="toc-what-is-arima"
                class="nav-link active"
                data-scroll-target="#what-is-arima"
                >What is ARIMA?</a
              >
              <ul class="collapse">
                <li>
                  <a
                    href="#arima-parameters-p-d-q"
                    id="toc-arima-parameters-p-d-q"
                    class="nav-link"
                    data-scroll-target="#arima-parameters-p-d-q"
                    >ARIMA Parameters (p, d, q)</a
                  >
                </li>
                <li>
                  <a
                    href="#why-use-arima-for-stock-prices"
                    id="toc-why-use-arima-for-stock-prices"
                    class="nav-link"
                    data-scroll-target="#why-use-arima-for-stock-prices"
                    >Why Use ARIMA for Stock Prices?</a
                  >
                </li>
              </ul>
            </li>
            <li>
              <a
                href="#import-dependencies"
                id="toc-import-dependencies"
                class="nav-link"
                data-scroll-target="#import-dependencies"
                >1. Import Dependencies</a
              >
            </li>
            <li>
              <a
                href="#load-stock-data"
                id="toc-load-stock-data"
                class="nav-link"
                data-scroll-target="#load-stock-data"
                >2. Load Stock Data</a
              >
            </li>
            <li>
              <a
                href="#exploratory-data-analysis-eda"
                id="toc-exploratory-data-analysis-eda"
                class="nav-link"
                data-scroll-target="#exploratory-data-analysis-eda"
                >3. Exploratory Data Analysis (EDA)</a
              >
            </li>
            <li>
              <a
                href="#traintest-split"
                id="toc-traintest-split"
                class="nav-link"
                data-scroll-target="#traintest-split"
                >4. Train/Test Split</a
              >
            </li>
            <li>
              <a
                href="#testing-for-stationarity"
                id="toc-testing-for-stationarity"
                class="nav-link"
                data-scroll-target="#testing-for-stationarity"
                >5. Testing for Stationarity</a
              >
            </li>
            <li>
              <a
                href="#differencing-making-data-stationary"
                id="toc-differencing-making-data-stationary"
                class="nav-link"
                data-scroll-target="#differencing-making-data-stationary"
                >6. Differencing: Making Data Stationary</a
              >
            </li>
            <li>
              <a
                href="#arima-model-training"
                id="toc-arima-model-training"
                class="nav-link"
                data-scroll-target="#arima-model-training"
                >7. ARIMA Model Training</a
              >
              <ul class="collapse">
                <li>
                  <a
                    href="#walk-forward-validation"
                    id="toc-walk-forward-validation"
                    class="nav-link"
                    data-scroll-target="#walk-forward-validation"
                    >Walk-Forward Validation</a
                  >
                </li>
              </ul>
            </li>
            <li>
              <a
                href="#understanding-the-cumulative-sum-reversal"
                id="toc-understanding-the-cumulative-sum-reversal"
                class="nav-link"
                data-scroll-target="#understanding-the-cumulative-sum-reversal"
                >8. Understanding the Cumulative Sum Reversal</a
              >
              <ul class="collapse">
                <li>
                  <a
                    href="#the-problem"
                    id="toc-the-problem"
                    class="nav-link"
                    data-scroll-target="#the-problem"
                    >The Problem</a
                  >
                </li>
                <li>
                  <a
                    href="#the-solution-cumulative-sum-cumsum"
                    id="toc-the-solution-cumulative-sum-cumsum"
                    class="nav-link"
                    data-scroll-target="#the-solution-cumulative-sum-cumsum"
                    >The Solution: Cumulative Sum (cumsum)</a
                  >
                </li>
              </ul>
            </li>
            <li>
              <a
                href="#error-calculation"
                id="toc-error-calculation"
                class="nav-link"
                data-scroll-target="#error-calculation"
                >9. Error Calculation</a
              >
              <ul class="collapse">
                <li>
                  <a
                    href="#mean-squared-error-mse"
                    id="toc-mean-squared-error-mse"
                    class="nav-link"
                    data-scroll-target="#mean-squared-error-mse"
                    >Mean Squared Error (MSE)</a
                  >
                </li>
                <li>
                  <a
                    href="#symmetric-mean-absolute-percentage-error-smape"
                    id="toc-symmetric-mean-absolute-percentage-error-smape"
                    class="nav-link"
                    data-scroll-target="#symmetric-mean-absolute-percentage-error-smape"
                    >Symmetric Mean Absolute Percentage Error (SMAPE)</a
                  >
                </li>
              </ul>
            </li>
            <li>
              <a
                href="#final-visualization-predictions-vs-actual"
                id="toc-final-visualization-predictions-vs-actual"
                class="nav-link"
                data-scroll-target="#final-visualization-predictions-vs-actual"
                >10. Final Visualization: Predictions vs Actual</a
              >
            </li>
            <li>
              <a
                href="#key-takeaways"
                id="toc-key-takeaways"
                class="nav-link"
                data-scroll-target="#key-takeaways"
                >11. Key Takeaways</a
              >
              <ul class="collapse">
                <li>
                  <a
                    href="#what-we-learned"
                    id="toc-what-we-learned"
                    class="nav-link"
                    data-scroll-target="#what-we-learned"
                    >What We Learned:</a
                  >
                </li>
                <li>
                  <a
                    href="#next-steps"
                    id="toc-next-steps"
                    class="nav-link"
                    data-scroll-target="#next-steps"
                    >Next Steps:</a
                  >
                </li>
              </ul>
            </li>
          </ul>
        </nav>
      </div>
      <!-- main -->
      <main class="content" id="quarto-document-content">
        <header id="title-block-header" class="quarto-title-block default">
          <div class="quarto-title">
            <h1 class="title">
              ARIMA Time Series Forecasting for Stock Prices
            </h1>
          </div>

          <div class="quarto-title-meta"></div>
        </header>

        <p>
          <strong>A Step-by-Step Guide to Predicting AAPL Stock Prices</strong>
        </p>
        <hr />
        <section id="what-is-arima" class="level2">
          <h2 class="anchored" data-anchor-id="what-is-arima">
            What is ARIMA?
          </h2>
          <p>
            <strong>ARIMA (AutoRegressive Integrated Moving Average)</strong> is
            a popular statistical model for time series forecasting. It combines
            three components:
          </p>
          <ul>
            <li>
              <strong>AR (AutoRegressive)</strong>: Uses past values to predict
              future values
            </li>
            <li>
              <strong>I (Integrated)</strong>: Differencing to make
              non-stationary data stationary
            </li>
            <li>
              <strong>MA (Moving Average)</strong>: Uses past forecast errors in
              the prediction
            </li>
          </ul>
          <section id="arima-parameters-p-d-q" class="level3">
            <h3 class="anchored" data-anchor-id="arima-parameters-p-d-q">
              ARIMA Parameters (p, d, q)
            </h3>
            <table class="caption-top table">
              <thead>
                <tr class="header">
                  <th>Parameter</th>
                  <th>Description</th>
                  <th>How to Choose</th>
                </tr>
              </thead>
              <tbody>
                <tr class="odd">
                  <td><strong>p</strong></td>
                  <td>Number of lag observations (AR terms)</td>
                  <td>Use PACF plot</td>
                </tr>
                <tr class="even">
                  <td><strong>d</strong></td>
                  <td>Degree of differencing</td>
                  <td>Use ADF test</td>
                </tr>
                <tr class="odd">
                  <td><strong>q</strong></td>
                  <td>Size of moving average window</td>
                  <td>Use ACF plot</td>
                </tr>
              </tbody>
            </table>
          </section>
          <section id="why-use-arima-for-stock-prices" class="level3">
            <h3
              class="anchored"
              data-anchor-id="why-use-arima-for-stock-prices"
            >
              Why Use ARIMA for Stock Prices?
            </h3>
            <ol type="1">
              <li>
                Stock prices exhibit <strong>trends</strong> (non-stationary
                behavior)
              </li>
              <li>ARIMA can handle trends through differencing</li>
              <li>Walk-forward validation simulates real trading scenarios</li>
              <li>Provides interpretable forecasts</li>
            </ol>
            <hr />
            <p>
              <strong>Author:</strong> Vedanth Ramanathan
              <strong>Repository:</strong>
              <a href="https://github.com/vedanthr5/vr-quantfolio-intro"
                >vr-quantfolio-intro</a
              >
            </p>
          </section>
        </section>
        <section id="import-dependencies" class="level2">
          <h2 class="anchored" data-anchor-id="import-dependencies">
            1. Import Dependencies
          </h2>
          <div id="41eff2ce" class="cell">
            <div class="code-copy-outer-scaffold">
              <div class="sourceCode cell-code" id="cb1">
                <pre
                  class="sourceCode python code-with-copy"
                ><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Core data manipulation and numerical computing</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualization libraries</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> plotly.graph_objects <span class="im">as</span> go</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> plotly.subplots <span class="im">import</span> make_subplots</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Financial data</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> yfinance <span class="im">as</span> yf</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Statistical tests and models</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> statsmodels.tsa.stattools <span class="im">import</span> adfuller, acf, pacf</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> statsmodels.graphics.tsaplots <span class="im">import</span> plot_acf, plot_pacf</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> statsmodels.tsa.arima.model <span class="im">import</span> ARIMA</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Machine learning metrics</span></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> mean_squared_error</span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Suppress warnings for cleaner output</span></span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> warnings</span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a>warnings.filterwarnings(<span class="st">'ignore'</span>)</span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"All dependencies imported successfully."</span>)</span></code></pre>
              </div>
              <button title="Copy to Clipboard" class="code-copy-button">
                <i class="bi"></i>
              </button>
            </div>
          </div>
        </section>
        <section id="load-stock-data" class="level2">
          <h2 class="anchored" data-anchor-id="load-stock-data">
            2. Load Stock Data
          </h2>
          <p>
            We’ll download AAPL (Apple Inc.) stock data from Yahoo Finance
            spanning from 2010 to 2025. This gives us approximately 15 years of
            daily trading data.
          </p>
          <div id="e4040090" class="cell">
            <div class="code-copy-outer-scaffold">
              <div class="sourceCode cell-code" id="cb2">
                <pre
                  class="sourceCode python code-with-copy"
                ><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Define stock parameters</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>stock <span class="op">=</span> <span class="st">"AAPL"</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>start_date <span class="op">=</span> <span class="st">"2010-12-20"</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>end_date <span class="op">=</span> <span class="st">"2025-12-30"</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Download stock data from Yahoo Finance</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="co"># auto_adjust=False keeps original OHLC prices (not adjusted for splits/dividends)</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="co"># multi_level_index=False gives us simple column names</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> yf.download(</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>    stock, </span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>    start<span class="op">=</span>start_date, </span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>    end<span class="op">=</span>end_date, </span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>    auto_adjust<span class="op">=</span><span class="va">False</span>, </span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>    multi_level_index<span class="op">=</span><span class="va">False</span></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Check for and remove any missing values</span></span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Missing values: </span><span class="sc">{</span>df<span class="sc">.</span>isnull()<span class="sc">.</span>values<span class="sc">.</span><span class="bu">any</span>()<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> df.dropna()</span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Display basic info</span></span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="sc">{</span>stock<span class="sc">}</span><span class="ss"> Stock Data Summary:"</span>)</span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"   Date Range: </span><span class="sc">{</span>df<span class="sc">.</span>index<span class="sc">.</span><span class="bu">min</span>()<span class="sc">.</span>date()<span class="sc">}</span><span class="ss"> to </span><span class="sc">{</span>df<span class="sc">.</span>index<span class="sc">.</span><span class="bu">max</span>()<span class="sc">.</span>date()<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"   Trading Days: </span><span class="sc">{</span><span class="bu">len</span>(df)<span class="sc">:,}</span><span class="ss">"</span>)</span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"   Columns: </span><span class="sc">{</span><span class="bu">list</span>(df.columns)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a><span class="co"># Show first few rows</span></span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a>df.head()</span></code></pre>
              </div>
              <button title="Copy to Clipboard" class="code-copy-button">
                <i class="bi"></i>
              </button>
            </div>
          </div>
        </section>
        <section id="exploratory-data-analysis-eda" class="level2">
          <h2 class="anchored" data-anchor-id="exploratory-data-analysis-eda">
            3. Exploratory Data Analysis (EDA)
          </h2>
          <p>
            Let’s visualize the stock price to understand its behavior over
            time. We’ll focus on the <strong>Close</strong> price, which is what
            we’ll be forecasting.
          </p>
          <div id="edd5a9f6" class="cell">
            <div class="code-copy-outer-scaffold">
              <div class="sourceCode cell-code" id="cb3">
                <pre
                  class="sourceCode python code-with-copy"
                ><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create interactive price chart with Plotly</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>fig <span class="op">=</span> go.Figure()</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>fig.add_trace(go.Scatter(</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>    x<span class="op">=</span>df.index, </span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>    y<span class="op">=</span>df[<span class="st">'Close'</span>],</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>    mode<span class="op">=</span><span class="st">'lines'</span>,</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>    name<span class="op">=</span><span class="st">'Close Price'</span>,</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>    line<span class="op">=</span><span class="bu">dict</span>(color<span class="op">=</span><span class="st">'#2196F3'</span>, width<span class="op">=</span><span class="fl">1.5</span>)</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>))</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>fig.update_layout(</span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>    title<span class="op">=</span><span class="ss">f'</span><span class="sc">{</span>stock<span class="sc">}</span><span class="ss"> Stock Price History'</span>,</span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>    xaxis_title<span class="op">=</span><span class="st">'Date'</span>,</span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>    yaxis_title<span class="op">=</span><span class="st">'Price (USD)'</span>,</span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>    template<span class="op">=</span><span class="st">'plotly_white'</span>,</span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>    height<span class="op">=</span><span class="dv">500</span>,</span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>    hovermode<span class="op">=</span><span class="st">'x unified'</span></span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a>fig.show()</span></code></pre>
              </div>
              <button title="Copy to Clipboard" class="code-copy-button">
                <i class="bi"></i>
              </button>
            </div>
          </div>
        </section>
        <section id="traintest-split" class="level2">
          <h2 class="anchored" data-anchor-id="traintest-split">
            4. Train/Test Split
          </h2>
          <p>
            For time series data, we <strong>cannot</strong> use random splits
            because the order of observations matters. We split chronologically:
            - <strong>Training Set (80%)</strong>: Historical data the model
            learns from - <strong>Test Set (20%)</strong>: Recent data to
            evaluate predictions
          </p>
          <div id="9b73e73b" class="cell">
            <div class="code-copy-outer-scaffold">
              <div class="sourceCode cell-code" id="cb4">
                <pre
                  class="sourceCode python code-with-copy"
                ><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Split data: 80% training, 20% testing</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>train_size <span class="op">=</span> <span class="bu">int</span>(<span class="bu">len</span>(df) <span class="op">*</span> <span class="fl">0.8</span>)</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>train <span class="op">=</span> df[<span class="st">'Close'</span>][:train_size]</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>test <span class="op">=</span> df[<span class="st">'Close'</span>][train_size:]</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Training Set: </span><span class="sc">{</span><span class="bu">len</span>(train)<span class="sc">:,}</span><span class="ss"> observations"</span>)</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"   From: </span><span class="sc">{</span>train<span class="sc">.</span>index<span class="sc">.</span><span class="bu">min</span>()<span class="sc">.</span>date()<span class="sc">}</span><span class="ss"> to </span><span class="sc">{</span>train<span class="sc">.</span>index<span class="sc">.</span><span class="bu">max</span>()<span class="sc">.</span>date()<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Test Set: </span><span class="sc">{</span><span class="bu">len</span>(test)<span class="sc">:,}</span><span class="ss"> observations"</span>)</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"   From: </span><span class="sc">{</span>test<span class="sc">.</span>index<span class="sc">.</span><span class="bu">min</span>()<span class="sc">.</span>date()<span class="sc">}</span><span class="ss"> to </span><span class="sc">{</span>test<span class="sc">.</span>index<span class="sc">.</span><span class="bu">max</span>()<span class="sc">.</span>date()<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualize the split</span></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>fig <span class="op">=</span> go.Figure()</span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>fig.add_trace(go.Scatter(</span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>    x<span class="op">=</span>train.index, y<span class="op">=</span>train.values,</span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a>    mode<span class="op">=</span><span class="st">'lines'</span>, name<span class="op">=</span><span class="st">'Training Data'</span>,</span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a>    line<span class="op">=</span><span class="bu">dict</span>(color<span class="op">=</span><span class="st">'#4CAF50'</span>, width<span class="op">=</span><span class="fl">1.5</span>)</span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a>))</span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a>fig.add_trace(go.Scatter(</span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a>    x<span class="op">=</span>test.index, y<span class="op">=</span>test.values,</span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a>    mode<span class="op">=</span><span class="st">'lines'</span>, name<span class="op">=</span><span class="st">'Test Data'</span>,</span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a>    line<span class="op">=</span><span class="bu">dict</span>(color<span class="op">=</span><span class="st">'#FF5722'</span>, width<span class="op">=</span><span class="fl">1.5</span>)</span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a>))</span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-27"><a href="#cb4-27" aria-hidden="true" tabindex="-1"></a>fig.update_layout(</span>
<span id="cb4-28"><a href="#cb4-28" aria-hidden="true" tabindex="-1"></a>    title<span class="op">=</span><span class="st">'Train/Test Split Visualization'</span>,</span>
<span id="cb4-29"><a href="#cb4-29" aria-hidden="true" tabindex="-1"></a>    xaxis_title<span class="op">=</span><span class="st">'Date'</span>,</span>
<span id="cb4-30"><a href="#cb4-30" aria-hidden="true" tabindex="-1"></a>    yaxis_title<span class="op">=</span><span class="st">'Close Price (USD)'</span>,</span>
<span id="cb4-31"><a href="#cb4-31" aria-hidden="true" tabindex="-1"></a>    template<span class="op">=</span><span class="st">'plotly_white'</span>,</span>
<span id="cb4-32"><a href="#cb4-32" aria-hidden="true" tabindex="-1"></a>    height<span class="op">=</span><span class="dv">450</span></span>
<span id="cb4-33"><a href="#cb4-33" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb4-34"><a href="#cb4-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-35"><a href="#cb4-35" aria-hidden="true" tabindex="-1"></a>fig.show()</span></code></pre>
              </div>
              <button title="Copy to Clipboard" class="code-copy-button">
                <i class="bi"></i>
              </button>
            </div>
          </div>
        </section>
        <section id="testing-for-stationarity" class="level2">
          <h2 class="anchored" data-anchor-id="testing-for-stationarity">
            5. Testing for Stationarity
          </h2>
          <p>
            ARIMA requires <strong>stationary</strong> data, meaning: - Constant
            mean over time - Constant variance over time - No seasonal patterns
          </p>
          <p>
            We use the <strong>Augmented Dickey-Fuller (ADF) Test</strong>: -
            <strong>H₀ (Null)</strong>: The series has a unit root
            (non-stationary) - <strong>H₁ (Alternative)</strong>: The series is
            stationary
          </p>
          <p>
            If <strong>p-value &lt; 0.05</strong>, we reject H₀ and conclude the
            series is stationary.
          </p>
          <div id="e042bf16" class="cell">
            <div class="code-copy-outer-scaffold">
              <div class="sourceCode cell-code" id="cb5">
                <pre
                  class="sourceCode python code-with-copy"
                ><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Function to perform ADF test and display results</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> adf_test(series, title<span class="op">=</span><span class="st">''</span>):</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="co">    Perform Augmented Dickey-Fuller test for stationarity.</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="co">    </span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a><span class="co">    Returns:</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a><span class="co">        bool: True if stationary (p &lt; 0.05), False otherwise</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>    result <span class="op">=</span> adfuller(series.dropna())</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"ADF Test Results </span><span class="sc">{</span>title<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"-"</span> <span class="op">*</span> <span class="dv">40</span>)</span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"   Test Statistic: </span><span class="sc">{</span>result[<span class="dv">0</span>]<span class="sc">:.4f}</span><span class="ss">"</span>)</span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"   P-Value: </span><span class="sc">{</span>result[<span class="dv">1</span>]<span class="sc">:.6f}</span><span class="ss">"</span>)</span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"   Lags Used: </span><span class="sc">{</span>result[<span class="dv">2</span>]<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"   Observations: </span><span class="sc">{</span>result[<span class="dv">3</span>]<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">   Critical Values:"</span>)</span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> key, value <span class="kw">in</span> result[<span class="dv">4</span>].items():</span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"      </span><span class="sc">{</span>key<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span>value<span class="sc">:.4f}</span><span class="ss">"</span>)</span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a>    is_stationary <span class="op">=</span> result[<span class="dv">1</span>] <span class="op">&lt;</span> <span class="fl">0.05</span></span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">   Conclusion: </span><span class="sc">{</span><span class="st">'STATIONARY'</span> <span class="cf">if</span> is_stationary <span class="cf">else</span> <span class="st">'NON-STATIONARY'</span><span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> is_stationary</span>
<span id="cb5-25"><a href="#cb5-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-26"><a href="#cb5-26" aria-hidden="true" tabindex="-1"></a><span class="co"># Test original price series</span></span>
<span id="cb5-27"><a href="#cb5-27" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Testing ORIGINAL Close Prices:</span><span class="ch">\n</span><span class="st">"</span>)</span>
<span id="cb5-28"><a href="#cb5-28" aria-hidden="true" tabindex="-1"></a>is_original_stationary <span class="op">=</span> adf_test(train, title<span class="op">=</span><span class="st">'(Original Prices)'</span>)</span></code></pre>
              </div>
              <button title="Copy to Clipboard" class="code-copy-button">
                <i class="bi"></i>
              </button>
            </div>
          </div>
        </section>
        <section id="differencing-making-data-stationary" class="level2">
          <h2
            class="anchored"
            data-anchor-id="differencing-making-data-stationary"
          >
            6. Differencing: Making Data Stationary
          </h2>
          <p>
            Since stock prices are non-stationary (they trend upward/downward),
            we apply <strong>differencing</strong>:
          </p>
          <p><span class="math display">\[X'_t = X_t - X_{t-1}\]</span></p>
          <p>
            This transforms prices into <strong>daily changes</strong>, which
            fluctuate around zero and are typically stationary.
          </p>
          <p>
            <strong>Why this works:</strong> - Original:
            <code>[100, 102, 105, 103, 108]</code> → Trending up - Differenced:
            <code>[+2, +3, -2, +5]</code> → Fluctuates around zero
          </p>
          <div id="9de61e03" class="cell">
            <div class="code-copy-outer-scaffold">
              <div class="sourceCode cell-code" id="cb6">
                <pre
                  class="sourceCode python code-with-copy"
                ><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Apply differencing to training data</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="co"># diff() computes: current_value - previous_value</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>train_diff <span class="op">=</span> train.diff().dropna()</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualize before and after differencing</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>fig, axes <span class="op">=</span> plt.subplots(<span class="dv">2</span>, <span class="dv">1</span>, figsize<span class="op">=</span>(<span class="dv">14</span>, <span class="dv">8</span>))</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Original prices</span></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].plot(train.index, train.values, color<span class="op">=</span><span class="st">'#2196F3'</span>, linewidth<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].set_title(<span class="st">'Original Prices (Non-Stationary)'</span>, fontsize<span class="op">=</span><span class="dv">12</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].set_xlabel(<span class="st">'Date'</span>)</span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].set_ylabel(<span class="st">'Price (USD)'</span>)</span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].grid(<span class="va">True</span>, alpha<span class="op">=</span><span class="fl">0.3</span>)</span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Differenced prices</span></span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].plot(train_diff.index, train_diff.values, color<span class="op">=</span><span class="st">'#4CAF50'</span>, linewidth<span class="op">=</span><span class="fl">0.8</span>)</span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].axhline(y<span class="op">=</span><span class="dv">0</span>, color<span class="op">=</span><span class="st">'red'</span>, linestyle<span class="op">=</span><span class="st">'--'</span>, alpha<span class="op">=</span><span class="fl">0.7</span>, label<span class="op">=</span><span class="st">'Zero Line'</span>)</span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].set_title(<span class="st">'Differenced Prices (Stationary)'</span>, fontsize<span class="op">=</span><span class="dv">12</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].set_xlabel(<span class="st">'Date'</span>)</span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].set_ylabel(<span class="st">'Daily Change (USD)'</span>)</span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].legend()</span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].grid(<span class="va">True</span>, alpha<span class="op">=</span><span class="fl">0.3</span>)</span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb6-25"><a href="#cb6-25" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb6-26"><a href="#cb6-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-27"><a href="#cb6-27" aria-hidden="true" tabindex="-1"></a><span class="co"># Test if differenced series is stationary</span></span>
<span id="cb6-28"><a href="#cb6-28" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">"</span> <span class="op">+</span> <span class="st">"="</span><span class="op">*</span><span class="dv">50</span>)</span>
<span id="cb6-29"><a href="#cb6-29" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Testing DIFFERENCED Close Prices:</span><span class="ch">\n</span><span class="st">"</span>)</span>
<span id="cb6-30"><a href="#cb6-30" aria-hidden="true" tabindex="-1"></a>is_diff_stationary <span class="op">=</span> adf_test(train_diff, title<span class="op">=</span><span class="st">'(Differenced Prices)'</span>)</span></code></pre>
              </div>
              <button title="Copy to Clipboard" class="code-copy-button">
                <i class="bi"></i>
              </button>
            </div>
          </div>
        </section>
        <section id="arima-model-training" class="level2">
          <h2 class="anchored" data-anchor-id="arima-model-training">
            7. ARIMA Model Training
          </h2>
          <p>
            Now we’ll train an ARIMA model with: - <strong>p = 1</strong>: One
            autoregressive term (uses 1 past value) - <strong>d = 2</strong>:
            Two levels of differencing (ARIMA applies its own differencing) -
            <strong>q = 1</strong>: One moving average term
          </p>
          <section id="walk-forward-validation" class="level3">
            <h3 class="anchored" data-anchor-id="walk-forward-validation">
              Walk-Forward Validation
            </h3>
            <p>
              Instead of training once and predicting all test data, we use
              <strong>walk-forward validation</strong>: 1. Train on all
              available historical data 2. Predict the next day 3. Add that
              actual value to training set 4. Retrain and repeat
            </p>
            <p>
              This mimics real-world trading where you retrain models as new
              data arrives.
            </p>
            <div id="c883f3cf" class="cell">
              <div class="code-copy-outer-scaffold">
                <div class="sourceCode cell-code" id="cb7">
                  <pre
                    class="sourceCode python code-with-copy"
                  ><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Prepare data for walk-forward validation</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="co"># history: growing list of training observations (starts with full train set)</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>history <span class="op">=</span> train.tolist()</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="co"># predictions: will store our model's forecasts for each test observation</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>predictions <span class="op">=</span> []</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a><span class="co"># ARIMA parameters</span></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>order <span class="op">=</span> (<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">1</span>)  <span class="co"># (p, d, q)</span></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Starting Walk-Forward ARIMA Training"</span>)</span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"   Order: </span><span class="sc">{</span>order<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"   Test observations to predict: </span><span class="sc">{</span><span class="bu">len</span>(test)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"-"</span> <span class="op">*</span> <span class="dv">50</span>)</span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Walk-forward validation loop</span></span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a><span class="co"># For each day in test set: train model, predict, add actual, repeat</span></span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> t <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(test)):</span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Train ARIMA model on all historical data available so far</span></span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a>    model <span class="op">=</span> ARIMA(history, order<span class="op">=</span>order)</span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a>    model_fit <span class="op">=</span> model.fit()</span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Forecast the next day's price</span></span>
<span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a>    <span class="co"># forecast() returns an array, we take the first (only) element</span></span>
<span id="cb7-25"><a href="#cb7-25" aria-hidden="true" tabindex="-1"></a>    yhat <span class="op">=</span> model_fit.forecast()[<span class="dv">0</span>]</span>
<span id="cb7-26"><a href="#cb7-26" aria-hidden="true" tabindex="-1"></a>    predictions.append(yhat)</span>
<span id="cb7-27"><a href="#cb7-27" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb7-28"><a href="#cb7-28" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Add the ACTUAL observed value to history for next iteration</span></span>
<span id="cb7-29"><a href="#cb7-29" aria-hidden="true" tabindex="-1"></a>    <span class="co"># This is key: we're NOT adding our prediction, but the real value</span></span>
<span id="cb7-30"><a href="#cb7-30" aria-hidden="true" tabindex="-1"></a>    actual <span class="op">=</span> test.iloc[t]</span>
<span id="cb7-31"><a href="#cb7-31" aria-hidden="true" tabindex="-1"></a>    history.append(actual)</span>
<span id="cb7-32"><a href="#cb7-32" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb7-33"><a href="#cb7-33" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Progress update every 100 iterations</span></span>
<span id="cb7-34"><a href="#cb7-34" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (t <span class="op">+</span> <span class="dv">1</span>) <span class="op">%</span> <span class="dv">100</span> <span class="op">==</span> <span class="dv">0</span> <span class="kw">or</span> t <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb7-35"><a href="#cb7-35" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"   Completed </span><span class="sc">{</span>t <span class="op">+</span> <span class="dv">1</span><span class="sc">}</span><span class="ss">/</span><span class="sc">{</span><span class="bu">len</span>(test)<span class="sc">}</span><span class="ss"> predictions"</span>)</span>
<span id="cb7-36"><a href="#cb7-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-37"><a href="#cb7-37" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Training complete. Generated </span><span class="sc">{</span><span class="bu">len</span>(predictions)<span class="sc">}</span><span class="ss"> predictions."</span>)</span></code></pre>
                </div>
                <button title="Copy to Clipboard" class="code-copy-button">
                  <i class="bi"></i>
                </button>
              </div>
            </div>
          </section>
        </section>
        <section id="understanding-the-cumulative-sum-reversal" class="level2">
          <h2
            class="anchored"
            data-anchor-id="understanding-the-cumulative-sum-reversal"
          >
            8. Understanding the Cumulative Sum Reversal
          </h2>
          <p>
            ⚠️ <strong>Critical Concept</strong>: ARIMA with
            <code>d=2</code> works on <strong>twice-differenced data</strong>.
            Its predictions are in “change-of-changes” space, NOT actual prices!
          </p>
          <section id="the-problem" class="level3">
            <h3 class="anchored" data-anchor-id="the-problem">The Problem</h3>
            <ul>
              <li>
                Raw ARIMA predictions: Changes in changes (meaningless for
                trading)
              </li>
              <li>What we need: Actual price predictions</li>
            </ul>
          </section>
          <section id="the-solution-cumulative-sum-cumsum" class="level3">
            <h3
              class="anchored"
              data-anchor-id="the-solution-cumulative-sum-cumsum"
            >
              The Solution: Cumulative Sum (cumsum)
            </h3>
            <p>
              Since differencing = subtraction, the inverse is
              <strong>cumulative sum</strong> (adding up).
            </p>
            <p><strong>Example:</strong></p>
            <pre><code>Original prices:     [100, 102, 105, 103, 108]
1st diff (changes):  [+2, +3, -2, +5]
2nd diff (Δchanges): [+1, -5, +7]

To reverse:
cumsum([+1, -5, +7]) → [+1, -4, +3] ≈ 1st diff
cumsum([+2, +1, -4, +3]) → [2, 3, -1, 2] ... needs anchor!</code></pre>
            <p>
              We anchor the cumsum at the
              <strong>last known training price</strong> to get actual
              predictions.
            </p>
            <div id="acbcb68d" class="cell">
              <div class="code-copy-outer-scaffold">
                <div class="sourceCode cell-code" id="cb9">
                  <pre
                    class="sourceCode python code-with-copy"
                  ><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ============================================================</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="co"># STEP 1: Apply differencing to test data (for comparison)</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="co"># ============================================================</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="co"># We difference test data to get "changes" which ARIMA predicts</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>test_diff <span class="op">=</span> test.diff().dropna()</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a><span class="co"># ============================================================</span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a><span class="co"># STEP 2: Convert predictions to pandas Series with proper index</span></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a><span class="co"># ============================================================</span></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a><span class="co"># predictions list -&gt; Series aligned with test dates</span></span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>predictions_series <span class="op">=</span> pd.Series(predictions, index<span class="op">=</span>test.index)</span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Difference the predictions too (since ARIMA predicts d=2 space)</span></span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>predictions_diff <span class="op">=</span> predictions_series.diff().dropna()</span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a><span class="co"># ============================================================</span></span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a><span class="co"># STEP 3: Cumulative sum reversal - THE KEY STEP</span></span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a><span class="co"># ============================================================</span></span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a><span class="co"># cumsum() reverses differencing by accumulating the changes</span></span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a><span class="co"># But we need an anchor point - the last known price before test period</span></span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Get the anchor: last training price</span></span>
<span id="cb9-23"><a href="#cb9-23" aria-hidden="true" tabindex="-1"></a>anchor_price <span class="op">=</span> train.iloc[<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb9-24"><a href="#cb9-24" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Anchor price (last training value): $</span><span class="sc">{</span>anchor_price<span class="sc">:.2f}</span><span class="ss">"</span>)</span>
<span id="cb9-25"><a href="#cb9-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-26"><a href="#cb9-26" aria-hidden="true" tabindex="-1"></a><span class="co"># Reverse the differencing for ACTUAL test values</span></span>
<span id="cb9-27"><a href="#cb9-27" aria-hidden="true" tabindex="-1"></a><span class="co"># cumsum() accumulates: [a, b, c] -&gt; [a, a+b, a+b+c]</span></span>
<span id="cb9-28"><a href="#cb9-28" aria-hidden="true" tabindex="-1"></a><span class="co"># Adding anchor shifts the whole series to correct price level</span></span>
<span id="cb9-29"><a href="#cb9-29" aria-hidden="true" tabindex="-1"></a>reverse_test_diff <span class="op">=</span> test_diff.cumsum() <span class="op">+</span> anchor_price</span>
<span id="cb9-30"><a href="#cb9-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-31"><a href="#cb9-31" aria-hidden="true" tabindex="-1"></a><span class="co"># Reverse the differencing for PREDICTED values</span></span>
<span id="cb9-32"><a href="#cb9-32" aria-hidden="true" tabindex="-1"></a>reverse_predictions <span class="op">=</span> predictions_diff.cumsum() <span class="op">+</span> anchor_price</span>
<span id="cb9-33"><a href="#cb9-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-34"><a href="#cb9-34" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Reversed </span><span class="sc">{</span><span class="bu">len</span>(reverse_predictions)<span class="sc">}</span><span class="ss"> predictions back to price space."</span>)</span></code></pre>
                </div>
                <button title="Copy to Clipboard" class="code-copy-button">
                  <i class="bi"></i>
                </button>
              </div>
            </div>
          </section>
        </section>
        <section id="error-calculation" class="level2">
          <h2 class="anchored" data-anchor-id="error-calculation">
            9. Error Calculation
          </h2>
          <p>We evaluate model performance using two metrics:</p>
          <section id="mean-squared-error-mse" class="level3">
            <h3 class="anchored" data-anchor-id="mean-squared-error-mse">
              Mean Squared Error (MSE)
            </h3>
            <p>
              <span class="math display"
                >\[MSE = \frac{1}{n}\sum_{i=1}^{n}(y_i - \hat{y}_i)^2\]</span
              >
              - Penalizes large errors heavily (squared) - Lower is better
            </p>
          </section>
          <section
            id="symmetric-mean-absolute-percentage-error-smape"
            class="level3"
          >
            <h3
              class="anchored"
              data-anchor-id="symmetric-mean-absolute-percentage-error-smape"
            >
              Symmetric Mean Absolute Percentage Error (SMAPE)
            </h3>
            <p>
              <span class="math display"
                >\[SMAPE = \frac{100\%}{n}\sum_{i=1}^{n}\frac{|y_i -
                \hat{y}_i|}{(|y_i| + |\hat{y}_i|)/2}\]</span
              >
              - Scale-independent (percentage) - Ranges from 0% (perfect) to
              200% (terrible) - Symmetric: treats over/under-prediction equally
            </p>
            <div id="c233b56d" class="cell">
              <div class="code-copy-outer-scaffold">
                <div class="sourceCode cell-code" id="cb10">
                  <pre
                    class="sourceCode python code-with-copy"
                  ><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ============================================================</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="co"># FINAL STEP: Calculate prediction error metrics</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="co"># ============================================================</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> mean_absolute_error, mean_squared_error</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Align the series (they should match but let's be safe)</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Use intersection of indices</span></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>common_index <span class="op">=</span> reverse_test_diff.index.intersection(reverse_predictions.index)</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>actual <span class="op">=</span> reverse_test_diff.loc[common_index]</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>predicted <span class="op">=</span> reverse_predictions.loc[common_index]</span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate metrics</span></span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>mae <span class="op">=</span> mean_absolute_error(actual, predicted)</span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>rmse <span class="op">=</span> np.sqrt(mean_squared_error(actual, predicted))</span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a>mape <span class="op">=</span> np.mean(np.<span class="bu">abs</span>((actual <span class="op">-</span> predicted) <span class="op">/</span> actual)) <span class="op">*</span> <span class="dv">100</span></span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Prediction Error Metrics"</span>)</span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">40</span>)</span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Mean Absolute Error (MAE):     $</span><span class="sc">{</span>mae<span class="sc">:.2f}</span><span class="ss">"</span>)</span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Root Mean Squared Error (RMSE): $</span><span class="sc">{</span>rmse<span class="sc">:.2f}</span><span class="ss">"</span>)</span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Mean Absolute % Error (MAPE):  </span><span class="sc">{</span>mape<span class="sc">:.2f}</span><span class="ss">%"</span>)</span>
<span id="cb10-22"><a href="#cb10-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-23"><a href="#cb10-23" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Interpretation"</span>)</span>
<span id="cb10-24"><a href="#cb10-24" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"-"</span> <span class="op">*</span> <span class="dv">40</span>)</span>
<span id="cb10-25"><a href="#cb10-25" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"On average, predictions were off by $</span><span class="sc">{</span>mae<span class="sc">:.2f}</span><span class="ss">"</span>)</span>
<span id="cb10-26"><a href="#cb10-26" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"This represents a </span><span class="sc">{</span>mape<span class="sc">:.1f}</span><span class="ss">% error rate"</span>)</span>
<span id="cb10-27"><a href="#cb10-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-28"><a href="#cb10-28" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> mape <span class="op">&lt;</span> <span class="dv">5</span>:</span>
<span id="cb10-29"><a href="#cb10-29" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"Result: Excellent accuracy for stock prediction."</span>)</span>
<span id="cb10-30"><a href="#cb10-30" aria-hidden="true" tabindex="-1"></a><span class="cf">elif</span> mape <span class="op">&lt;</span> <span class="dv">10</span>:</span>
<span id="cb10-31"><a href="#cb10-31" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"Result: Good accuracy, usable for trend analysis."</span>)</span>
<span id="cb10-32"><a href="#cb10-32" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="cb10-33"><a href="#cb10-33" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"Result: Moderate accuracy - use with caution."</span>)</span></code></pre>
                </div>
                <button title="Copy to Clipboard" class="code-copy-button">
                  <i class="bi"></i>
                </button>
              </div>
            </div>
          </section>
        </section>
        <section id="final-visualization-predictions-vs-actual" class="level2">
          <h2
            class="anchored"
            data-anchor-id="final-visualization-predictions-vs-actual"
          >
            10. Final Visualization: Predictions vs Actual
          </h2>
          <p>Let’s visualize how well our ARIMA model performed:</p>
          <div id="ad54ab7e" class="cell">
            <div class="code-copy-outer-scaffold">
              <div class="sourceCode cell-code" id="cb11">
                <pre
                  class="sourceCode python code-with-copy"
                ><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create comprehensive visualization</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>fig <span class="op">=</span> make_subplots(</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>    rows<span class="op">=</span><span class="dv">2</span>, cols<span class="op">=</span><span class="dv">2</span>,</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>    subplot_titles<span class="op">=</span>(</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Full Price History with Predictions'</span>,</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Test Period: Actual vs Predicted'</span>,</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Prediction Errors Over Time'</span>,</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Error Distribution'</span></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>    vertical_spacing<span class="op">=</span><span class="fl">0.12</span>,</span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>    horizontal_spacing<span class="op">=</span><span class="fl">0.1</span></span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a><span class="co"># ---- Plot 1: Full history ----</span></span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a>fig.add_trace(</span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a>    go.Scatter(x<span class="op">=</span>train.index, y<span class="op">=</span>train.values, name<span class="op">=</span><span class="st">'Training Data'</span>,</span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a>               line<span class="op">=</span><span class="bu">dict</span>(color<span class="op">=</span><span class="st">'#2196F3'</span>, width<span class="op">=</span><span class="dv">1</span>)),</span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a>    row<span class="op">=</span><span class="dv">1</span>, col<span class="op">=</span><span class="dv">1</span></span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a>fig.add_trace(</span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true" tabindex="-1"></a>    go.Scatter(x<span class="op">=</span>actual_prices.index, y<span class="op">=</span>actual_prices.values, name<span class="op">=</span><span class="st">'Actual (Test)'</span>,</span>
<span id="cb11-22"><a href="#cb11-22" aria-hidden="true" tabindex="-1"></a>               line<span class="op">=</span><span class="bu">dict</span>(color<span class="op">=</span><span class="st">'#4CAF50'</span>, width<span class="op">=</span><span class="fl">1.5</span>)),</span>
<span id="cb11-23"><a href="#cb11-23" aria-hidden="true" tabindex="-1"></a>    row<span class="op">=</span><span class="dv">1</span>, col<span class="op">=</span><span class="dv">1</span></span>
<span id="cb11-24"><a href="#cb11-24" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb11-25"><a href="#cb11-25" aria-hidden="true" tabindex="-1"></a>fig.add_trace(</span>
<span id="cb11-26"><a href="#cb11-26" aria-hidden="true" tabindex="-1"></a>    go.Scatter(x<span class="op">=</span>predicted_prices.index, y<span class="op">=</span>predicted_prices.values, name<span class="op">=</span><span class="st">'Predicted'</span>,</span>
<span id="cb11-27"><a href="#cb11-27" aria-hidden="true" tabindex="-1"></a>               line<span class="op">=</span><span class="bu">dict</span>(color<span class="op">=</span><span class="st">'#FF5722'</span>, width<span class="op">=</span><span class="fl">1.5</span>, dash<span class="op">=</span><span class="st">'dash'</span>)),</span>
<span id="cb11-28"><a href="#cb11-28" aria-hidden="true" tabindex="-1"></a>    row<span class="op">=</span><span class="dv">1</span>, col<span class="op">=</span><span class="dv">1</span></span>
<span id="cb11-29"><a href="#cb11-29" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb11-30"><a href="#cb11-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-31"><a href="#cb11-31" aria-hidden="true" tabindex="-1"></a><span class="co"># ---- Plot 2: Zoomed test period ----</span></span>
<span id="cb11-32"><a href="#cb11-32" aria-hidden="true" tabindex="-1"></a>fig.add_trace(</span>
<span id="cb11-33"><a href="#cb11-33" aria-hidden="true" tabindex="-1"></a>    go.Scatter(x<span class="op">=</span>actual_prices.index, y<span class="op">=</span>actual_prices.values, name<span class="op">=</span><span class="st">'Actual'</span>,</span>
<span id="cb11-34"><a href="#cb11-34" aria-hidden="true" tabindex="-1"></a>               line<span class="op">=</span><span class="bu">dict</span>(color<span class="op">=</span><span class="st">'#4CAF50'</span>, width<span class="op">=</span><span class="dv">2</span>), showlegend<span class="op">=</span><span class="va">False</span>),</span>
<span id="cb11-35"><a href="#cb11-35" aria-hidden="true" tabindex="-1"></a>    row<span class="op">=</span><span class="dv">1</span>, col<span class="op">=</span><span class="dv">2</span></span>
<span id="cb11-36"><a href="#cb11-36" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb11-37"><a href="#cb11-37" aria-hidden="true" tabindex="-1"></a>fig.add_trace(</span>
<span id="cb11-38"><a href="#cb11-38" aria-hidden="true" tabindex="-1"></a>    go.Scatter(x<span class="op">=</span>predicted_prices.index, y<span class="op">=</span>predicted_prices.values, name<span class="op">=</span><span class="st">'Predicted'</span>,</span>
<span id="cb11-39"><a href="#cb11-39" aria-hidden="true" tabindex="-1"></a>               line<span class="op">=</span><span class="bu">dict</span>(color<span class="op">=</span><span class="st">'#FF5722'</span>, width<span class="op">=</span><span class="dv">2</span>, dash<span class="op">=</span><span class="st">'dash'</span>), showlegend<span class="op">=</span><span class="va">False</span>),</span>
<span id="cb11-40"><a href="#cb11-40" aria-hidden="true" tabindex="-1"></a>    row<span class="op">=</span><span class="dv">1</span>, col<span class="op">=</span><span class="dv">2</span></span>
<span id="cb11-41"><a href="#cb11-41" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb11-42"><a href="#cb11-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-43"><a href="#cb11-43" aria-hidden="true" tabindex="-1"></a><span class="co"># ---- Plot 3: Errors over time ----</span></span>
<span id="cb11-44"><a href="#cb11-44" aria-hidden="true" tabindex="-1"></a>errors <span class="op">=</span> actual_prices <span class="op">-</span> predicted_prices</span>
<span id="cb11-45"><a href="#cb11-45" aria-hidden="true" tabindex="-1"></a>fig.add_trace(</span>
<span id="cb11-46"><a href="#cb11-46" aria-hidden="true" tabindex="-1"></a>    go.Scatter(x<span class="op">=</span>errors.index, y<span class="op">=</span>errors.values, name<span class="op">=</span><span class="st">'Error'</span>,</span>
<span id="cb11-47"><a href="#cb11-47" aria-hidden="true" tabindex="-1"></a>               line<span class="op">=</span><span class="bu">dict</span>(color<span class="op">=</span><span class="st">'#9C27B0'</span>, width<span class="op">=</span><span class="dv">1</span>), showlegend<span class="op">=</span><span class="va">False</span>),</span>
<span id="cb11-48"><a href="#cb11-48" aria-hidden="true" tabindex="-1"></a>    row<span class="op">=</span><span class="dv">2</span>, col<span class="op">=</span><span class="dv">1</span></span>
<span id="cb11-49"><a href="#cb11-49" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb11-50"><a href="#cb11-50" aria-hidden="true" tabindex="-1"></a>fig.add_hline(y<span class="op">=</span><span class="dv">0</span>, line_dash<span class="op">=</span><span class="st">"dash"</span>, line_color<span class="op">=</span><span class="st">"red"</span>, row<span class="op">=</span><span class="dv">2</span>, col<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb11-51"><a href="#cb11-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-52"><a href="#cb11-52" aria-hidden="true" tabindex="-1"></a><span class="co"># ---- Plot 4: Error distribution ----</span></span>
<span id="cb11-53"><a href="#cb11-53" aria-hidden="true" tabindex="-1"></a>fig.add_trace(</span>
<span id="cb11-54"><a href="#cb11-54" aria-hidden="true" tabindex="-1"></a>    go.Histogram(x<span class="op">=</span>errors.values, nbinsx<span class="op">=</span><span class="dv">50</span>, name<span class="op">=</span><span class="st">'Error Distribution'</span>,</span>
<span id="cb11-55"><a href="#cb11-55" aria-hidden="true" tabindex="-1"></a>                 marker_color<span class="op">=</span><span class="st">'#9C27B0'</span>, showlegend<span class="op">=</span><span class="va">False</span>),</span>
<span id="cb11-56"><a href="#cb11-56" aria-hidden="true" tabindex="-1"></a>    row<span class="op">=</span><span class="dv">2</span>, col<span class="op">=</span><span class="dv">2</span></span>
<span id="cb11-57"><a href="#cb11-57" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb11-58"><a href="#cb11-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-59"><a href="#cb11-59" aria-hidden="true" tabindex="-1"></a><span class="co"># Update layout</span></span>
<span id="cb11-60"><a href="#cb11-60" aria-hidden="true" tabindex="-1"></a>fig.update_layout(</span>
<span id="cb11-61"><a href="#cb11-61" aria-hidden="true" tabindex="-1"></a>    height<span class="op">=</span><span class="dv">800</span>,</span>
<span id="cb11-62"><a href="#cb11-62" aria-hidden="true" tabindex="-1"></a>    title_text<span class="op">=</span><span class="ss">f'ARIMA(</span><span class="sc">{</span>order[<span class="dv">0</span>]<span class="sc">}</span><span class="ss">,</span><span class="sc">{</span>order[<span class="dv">1</span>]<span class="sc">}</span><span class="ss">,</span><span class="sc">{</span>order[<span class="dv">2</span>]<span class="sc">}</span><span class="ss">) Model Performance on </span><span class="sc">{</span>stock<span class="sc">}</span><span class="ss">'</span>,</span>
<span id="cb11-63"><a href="#cb11-63" aria-hidden="true" tabindex="-1"></a>    template<span class="op">=</span><span class="st">'plotly_white'</span>,</span>
<span id="cb11-64"><a href="#cb11-64" aria-hidden="true" tabindex="-1"></a>    showlegend<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb11-65"><a href="#cb11-65" aria-hidden="true" tabindex="-1"></a>    legend<span class="op">=</span><span class="bu">dict</span>(x<span class="op">=</span><span class="fl">0.02</span>, y<span class="op">=</span><span class="fl">0.98</span>)</span>
<span id="cb11-66"><a href="#cb11-66" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb11-67"><a href="#cb11-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-68"><a href="#cb11-68" aria-hidden="true" tabindex="-1"></a>fig.update_xaxes(title_text<span class="op">=</span><span class="st">'Date'</span>, row<span class="op">=</span><span class="dv">1</span>, col<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb11-69"><a href="#cb11-69" aria-hidden="true" tabindex="-1"></a>fig.update_xaxes(title_text<span class="op">=</span><span class="st">'Date'</span>, row<span class="op">=</span><span class="dv">1</span>, col<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb11-70"><a href="#cb11-70" aria-hidden="true" tabindex="-1"></a>fig.update_xaxes(title_text<span class="op">=</span><span class="st">'Date'</span>, row<span class="op">=</span><span class="dv">2</span>, col<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb11-71"><a href="#cb11-71" aria-hidden="true" tabindex="-1"></a>fig.update_xaxes(title_text<span class="op">=</span><span class="st">'Error ($)'</span>, row<span class="op">=</span><span class="dv">2</span>, col<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb11-72"><a href="#cb11-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-73"><a href="#cb11-73" aria-hidden="true" tabindex="-1"></a>fig.update_yaxes(title_text<span class="op">=</span><span class="st">'Price ($)'</span>, row<span class="op">=</span><span class="dv">1</span>, col<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb11-74"><a href="#cb11-74" aria-hidden="true" tabindex="-1"></a>fig.update_yaxes(title_text<span class="op">=</span><span class="st">'Price ($)'</span>, row<span class="op">=</span><span class="dv">1</span>, col<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb11-75"><a href="#cb11-75" aria-hidden="true" tabindex="-1"></a>fig.update_yaxes(title_text<span class="op">=</span><span class="st">'Error ($)'</span>, row<span class="op">=</span><span class="dv">2</span>, col<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb11-76"><a href="#cb11-76" aria-hidden="true" tabindex="-1"></a>fig.update_yaxes(title_text<span class="op">=</span><span class="st">'Count'</span>, row<span class="op">=</span><span class="dv">2</span>, col<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb11-77"><a href="#cb11-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-78"><a href="#cb11-78" aria-hidden="true" tabindex="-1"></a>fig.show()</span></code></pre>
              </div>
              <button title="Copy to Clipboard" class="code-copy-button">
                <i class="bi"></i>
              </button>
            </div>
          </div>
        </section>
        <section id="key-takeaways" class="level2">
          <h2 class="anchored" data-anchor-id="key-takeaways">
            11. Key Takeaways
          </h2>
          <section id="what-we-learned" class="level3">
            <h3 class="anchored" data-anchor-id="what-we-learned">
              What We Learned:
            </h3>
            <ol type="1">
              <li>
                <p>
                  <strong>Stationarity is Essential</strong>: ARIMA requires
                  stationary data. Stock prices are non-stationary, so we use
                  differencing.
                </p>
              </li>
              <li>
                <p><strong>The ARIMA Process</strong>:</p>
                <ul>
                  <li>
                    <code>p</code> (AR): How many past values influence the
                    current value
                  </li>
                  <li>
                    <code>d</code> (I): How many times to difference the data
                  </li>
                  <li>
                    <code>q</code> (MA): How many past forecast errors influence
                    the current forecast
                  </li>
                </ul>
              </li>
              <li>
                <p>
                  <strong>Walk-Forward Validation</strong>: More realistic than
                  train-once-predict-all because it mimics real trading
                  conditions.
                </p>
              </li>
              <li>
                <p>
                  <strong>Cumulative Sum Reversal</strong>: Essential to convert
                  ARIMA’s difference-space predictions back to actual prices.
                </p>
              </li>
              <li>
                <p><strong>Model Limitations</strong>:</p>
                <ul>
                  <li>ARIMA assumes linear relationships</li>
                  <li>Can’t capture complex patterns or external factors</li>
                  <li>Stock prices are notoriously hard to predict!</li>
                </ul>
              </li>
            </ol>
          </section>
          <section id="next-steps" class="level3">
            <h3 class="anchored" data-anchor-id="next-steps">Next Steps:</h3>
            <ul>
              <li>Try different (p, d, q) parameters</li>
              <li>
                Use <code>auto_arima</code> from <code>pmdarima</code> for
                automatic parameter selection
              </li>
              <li>Explore SARIMA for seasonal data</li>
              <li>Compare with machine learning approaches (LSTM, Prophet)</li>
            </ul>
          </section>
        </section>

        <a
          onclick="window.scrollTo(0, 0); return false;"
          role="button"
          id="quarto-back-to-top"
          ><i class="bi bi-arrow-up"></i> Back to top</a
        >
      </main>
      <!-- /main -->
      <script id="quarto-html-after-body" type="application/javascript">
        window.document.addEventListener("DOMContentLoaded", function (event) {
          // Ensure there is a toggle, if there isn't float one in the top right
          if (
            window.document.querySelector(".quarto-color-scheme-toggle") ===
            null
          ) {
            const a = window.document.createElement("a");
            a.classList.add("top-right");
            a.classList.add("quarto-color-scheme-toggle");
            a.href = "";
            a.onclick = function () {
              try {
                window.quartoToggleColorScheme();
              } catch {}
              return false;
            };
            const i = window.document.createElement("i");
            i.classList.add("bi");
            a.appendChild(i);
            window.document.body.appendChild(a);
          }
          setColorSchemeToggle(hasAlternateSentinel());
          const icon = "";
          const anchorJS = new window.AnchorJS();
          anchorJS.options = {
            placement: "right",
            icon: icon,
          };
          anchorJS.add(".anchored");
          const isCodeAnnotation = (el) => {
            for (const clz of el.classList) {
              if (clz.startsWith("code-annotation-")) {
                return true;
              }
            }
            return false;
          };
          const onCopySuccess = function (e) {
            // button target
            const button = e.trigger;
            // don't keep focus
            button.blur();
            // flash "checked"
            button.classList.add("code-copy-button-checked");
            var currentTitle = button.getAttribute("title");
            button.setAttribute("title", "Copied!");
            let tooltip;
            if (window.bootstrap) {
              button.setAttribute("data-bs-toggle", "tooltip");
              button.setAttribute("data-bs-placement", "left");
              button.setAttribute("data-bs-title", "Copied!");
              tooltip = new bootstrap.Tooltip(button, {
                trigger: "manual",
                customClass: "code-copy-button-tooltip",
                offset: [0, -8],
              });
              tooltip.show();
            }
            setTimeout(function () {
              if (tooltip) {
                tooltip.hide();
                button.removeAttribute("data-bs-title");
                button.removeAttribute("data-bs-toggle");
                button.removeAttribute("data-bs-placement");
              }
              button.setAttribute("title", currentTitle);
              button.classList.remove("code-copy-button-checked");
            }, 1000);
            // clear code selection
            e.clearSelection();
          };
          const getTextToCopy = function (trigger) {
            const outerScaffold = trigger.parentElement.cloneNode(true);
            const codeEl = outerScaffold.querySelector("code");
            for (const childEl of codeEl.children) {
              if (isCodeAnnotation(childEl)) {
                childEl.remove();
              }
            }
            return codeEl.innerText;
          };
          const clipboard = new window.ClipboardJS(
            ".code-copy-button:not([data-in-quarto-modal])",
            {
              text: getTextToCopy,
            }
          );
          clipboard.on("success", onCopySuccess);
          if (
            window.document.getElementById("quarto-embedded-source-code-modal")
          ) {
            const clipboardModal = new window.ClipboardJS(
              ".code-copy-button[data-in-quarto-modal]",
              {
                text: getTextToCopy,
                container: window.document.getElementById(
                  "quarto-embedded-source-code-modal"
                ),
              }
            );
            clipboardModal.on("success", onCopySuccess);
          }
          const viewSource =
            window.document.getElementById("quarto-view-source") ||
            window.document.getElementById("quarto-code-tools-source");
          if (viewSource) {
            const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
            viewSource.addEventListener("click", function (e) {
              if (sourceUrl) {
                // rstudio viewer pane
                if (/\bcapabilities=\b/.test(window.location)) {
                  window.open(sourceUrl);
                } else {
                  window.location.href = sourceUrl;
                }
              } else {
                const modal = new bootstrap.Modal(
                  document.getElementById("quarto-embedded-source-code-modal")
                );
                modal.show();
              }
              return false;
            });
          }
          function toggleCodeHandler(show) {
            return function (e) {
              const detailsSrc = window.document.querySelectorAll(
                ".cell > details > .sourceCode"
              );
              for (let i = 0; i < detailsSrc.length; i++) {
                const details = detailsSrc[i].parentElement;
                if (show) {
                  details.open = true;
                } else {
                  details.removeAttribute("open");
                }
              }
              const cellCodeDivs = window.document.querySelectorAll(
                ".cell > .sourceCode"
              );
              const fromCls = show ? "hidden" : "unhidden";
              const toCls = show ? "unhidden" : "hidden";
              for (let i = 0; i < cellCodeDivs.length; i++) {
                const codeDiv = cellCodeDivs[i];
                if (codeDiv.classList.contains(fromCls)) {
                  codeDiv.classList.remove(fromCls);
                  codeDiv.classList.add(toCls);
                }
              }
              return false;
            };
          }
          const hideAllCode = window.document.getElementById(
            "quarto-hide-all-code"
          );
          if (hideAllCode) {
            hideAllCode.addEventListener("click", toggleCodeHandler(false));
          }
          const showAllCode = window.document.getElementById(
            "quarto-show-all-code"
          );
          if (showAllCode) {
            showAllCode.addEventListener("click", toggleCodeHandler(true));
          }
          var localhostRegex = new RegExp(
            /^(?:http|https):\/\/localhost\:?[0-9]*\//
          );
          var mailtoRegex = new RegExp(/^mailto:/);
          var filterRegex = new RegExp("/" + window.location.host + "/");
          var isInternal = (href) => {
            return (
              filterRegex.test(href) ||
              localhostRegex.test(href) ||
              mailtoRegex.test(href)
            );
          };
          // Inspect non-navigation links and adorn them if external
          var links = window.document.querySelectorAll(
            "a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)"
          );
          for (var i = 0; i < links.length; i++) {
            const link = links[i];
            if (!isInternal(link.href)) {
              // undo the damage that might have been done by quarto-nav.js in the case of
              // links that we want to consider external
              if (link.dataset.originalHref !== undefined) {
                link.href = link.dataset.originalHref;
              }
            }
          }
          function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
            const config = {
              allowHTML: true,
              maxWidth: 500,
              delay: 100,
              arrow: false,
              appendTo: function (el) {
                return el.parentElement;
              },
              interactive: true,
              interactiveBorder: 10,
              theme: "quarto",
              placement: "bottom-start",
            };
            if (contentFn) {
              config.content = contentFn;
            }
            if (onTriggerFn) {
              config.onTrigger = onTriggerFn;
            }
            if (onUntriggerFn) {
              config.onUntrigger = onUntriggerFn;
            }
            window.tippy(el, config);
          }
          const noterefs = window.document.querySelectorAll(
            'a[role="doc-noteref"]'
          );
          for (var i = 0; i < noterefs.length; i++) {
            const ref = noterefs[i];
            tippyHover(ref, function () {
              // use id or data attribute instead here
              let href =
                ref.getAttribute("data-footnote-href") ||
                ref.getAttribute("href");
              try {
                href = new URL(href).hash;
              } catch {}
              const id = href.replace(/^#\/?/, "");
              const note = window.document.getElementById(id);
              if (note) {
                return note.innerHTML;
              } else {
                return "";
              }
            });
          }
          const xrefs = window.document.querySelectorAll("a.quarto-xref");
          const processXRef = (id, note) => {
            // Strip column container classes
            const stripColumnClz = (el) => {
              el.classList.remove("page-full", "page-columns");
              if (el.children) {
                for (const child of el.children) {
                  stripColumnClz(child);
                }
              }
            };
            stripColumnClz(note);
            if (id === null || id.startsWith("sec-")) {
              // Special case sections, only their first couple elements
              const container = document.createElement("div");
              if (note.children && note.children.length > 2) {
                container.appendChild(note.children[0].cloneNode(true));
                for (let i = 1; i < note.children.length; i++) {
                  const child = note.children[i];
                  if (child.tagName === "P" && child.innerText === "") {
                    continue;
                  } else {
                    container.appendChild(child.cloneNode(true));
                    break;
                  }
                }
                if (window.Quarto?.typesetMath) {
                  window.Quarto.typesetMath(container);
                }
                return container.innerHTML;
              } else {
                if (window.Quarto?.typesetMath) {
                  window.Quarto.typesetMath(note);
                }
                return note.innerHTML;
              }
            } else {
              // Remove any anchor links if they are present
              const anchorLink = note.querySelector("a.anchorjs-link");
              if (anchorLink) {
                anchorLink.remove();
              }
              if (window.Quarto?.typesetMath) {
                window.Quarto.typesetMath(note);
              }
              if (note.classList.contains("callout")) {
                return note.outerHTML;
              } else {
                return note.innerHTML;
              }
            }
          };
          for (var i = 0; i < xrefs.length; i++) {
            const xref = xrefs[i];
            tippyHover(
              xref,
              undefined,
              function (instance) {
                instance.disable();
                let url = xref.getAttribute("href");
                let hash = undefined;
                if (url.startsWith("#")) {
                  hash = url;
                } else {
                  try {
                    hash = new URL(url).hash;
                  } catch {}
                }
                if (hash) {
                  const id = hash.replace(/^#\/?/, "");
                  const note = window.document.getElementById(id);
                  if (note !== null) {
                    try {
                      const html = processXRef(id, note.cloneNode(true));
                      instance.setContent(html);
                    } finally {
                      instance.enable();
                      instance.show();
                    }
                  } else {
                    // See if we can fetch this
                    fetch(url.split("#")[0])
                      .then((res) => res.text())
                      .then((html) => {
                        const parser = new DOMParser();
                        const htmlDoc = parser.parseFromString(
                          html,
                          "text/html"
                        );
                        const note = htmlDoc.getElementById(id);
                        if (note !== null) {
                          const html = processXRef(id, note);
                          instance.setContent(html);
                        }
                      })
                      .finally(() => {
                        instance.enable();
                        instance.show();
                      });
                  }
                } else {
                  // See if we can fetch a full url (with no hash to target)
                  // This is a special case and we should probably do some content thinning / targeting
                  fetch(url)
                    .then((res) => res.text())
                    .then((html) => {
                      const parser = new DOMParser();
                      const htmlDoc = parser.parseFromString(html, "text/html");
                      const note = htmlDoc.querySelector("main.content");
                      if (note !== null) {
                        // This should only happen for chapter cross references
                        // (since there is no id in the URL)
                        // remove the first header
                        if (
                          note.children.length > 0 &&
                          note.children[0].tagName === "HEADER"
                        ) {
                          note.children[0].remove();
                        }
                        const html = processXRef(null, note);
                        instance.setContent(html);
                      }
                    })
                    .finally(() => {
                      instance.enable();
                      instance.show();
                    });
                }
              },
              function (instance) {}
            );
          }
          let selectedAnnoteEl;
          const selectorForAnnotation = (cell, annotation) => {
            let cellAttr = 'data-code-cell="' + cell + '"';
            let lineAttr = 'data-code-annotation="' + annotation + '"';
            const selector = "span[" + cellAttr + "][" + lineAttr + "]";
            return selector;
          };
          const selectCodeLines = (annoteEl) => {
            const doc = window.document;
            const targetCell = annoteEl.getAttribute("data-target-cell");
            const targetAnnotation = annoteEl.getAttribute(
              "data-target-annotation"
            );
            const annoteSpan = window.document.querySelector(
              selectorForAnnotation(targetCell, targetAnnotation)
            );
            const lines = annoteSpan.getAttribute("data-code-lines").split(",");
            const lineIds = lines.map((line) => {
              return targetCell + "-" + line;
            });
            let top = null;
            let height = null;
            let parent = null;
            if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
              if (lineIds.length > 1) {
                const lastEl = window.document.getElementById(
                  lineIds[lineIds.length - 1]
                );
                const bottom = lastEl.offsetTop + lastEl.offsetHeight;
                height = bottom - top;
              }
              if (top !== null && height !== null && parent !== null) {
                // cook up a div (if necessary) and position it
                let div = window.document.getElementById(
                  "code-annotation-line-highlight"
                );
                if (div === null) {
                  div = window.document.createElement("div");
                  div.setAttribute("id", "code-annotation-line-highlight");
                  div.style.position = "absolute";
                  parent.appendChild(div);
                }
                div.style.top = top - 2 + "px";
                div.style.height = height + 4 + "px";
                div.style.left = 0;
                let gutterDiv = window.document.getElementById(
                  "code-annotation-line-highlight-gutter"
                );
                if (gutterDiv === null) {
                  gutterDiv = window.document.createElement("div");
                  gutterDiv.setAttribute(
                    "id",
                    "code-annotation-line-highlight-gutter"
                  );
                  gutterDiv.style.position = "absolute";
                  const codeCell = window.document.getElementById(targetCell);
                  const gutter = codeCell.querySelector(
                    ".code-annotation-gutter"
                  );
                  gutter.appendChild(gutterDiv);
                }
                gutterDiv.style.top = top - 2 + "px";
                gutterDiv.style.height = height + 4 + "px";
              }
              selectedAnnoteEl = annoteEl;
            }
          };
          const unselectCodeLines = () => {
            const elementsIds = [
              "code-annotation-line-highlight",
              "code-annotation-line-highlight-gutter",
            ];
            elementsIds.forEach((elId) => {
              const div = window.document.getElementById(elId);
              if (div) {
                div.remove();
              }
            });
            selectedAnnoteEl = undefined;
          };
          // Handle positioning of the toggle
          window.addEventListener(
            "resize",
            throttle(() => {
              elRect = undefined;
              if (selectedAnnoteEl) {
                selectCodeLines(selectedAnnoteEl);
              }
            }, 10)
          );
          function throttle(fn, ms) {
            let throttle = false;
            let timer;
            return (...args) => {
              if (!throttle) {
                // first call gets through
                fn.apply(this, args);
                throttle = true;
              } else {
                // all the others get throttled
                if (timer) clearTimeout(timer); // cancel #2
                timer = setTimeout(() => {
                  fn.apply(this, args);
                  timer = throttle = false;
                }, ms);
              }
            };
          }
          // Attach click handler to the DT
          const annoteDls = window.document.querySelectorAll(
            "dt[data-target-cell]"
          );
          for (const annoteDlNode of annoteDls) {
            annoteDlNode.addEventListener("click", (event) => {
              const clickedEl = event.target;
              if (clickedEl !== selectedAnnoteEl) {
                unselectCodeLines();
                const activeEl = window.document.querySelector(
                  "dt[data-target-cell].code-annotation-active"
                );
                if (activeEl) {
                  activeEl.classList.remove("code-annotation-active");
                }
                selectCodeLines(clickedEl);
                clickedEl.classList.add("code-annotation-active");
              } else {
                // Unselect the line
                unselectCodeLines();
                clickedEl.classList.remove("code-annotation-active");
              }
            });
          }
          const findCites = (el) => {
            const parentEl = el.parentElement;
            if (parentEl) {
              const cites = parentEl.dataset.cites;
              if (cites) {
                return {
                  el,
                  cites: cites.split(" "),
                };
              } else {
                return findCites(el.parentElement);
              }
            } else {
              return undefined;
            }
          };
          var bibliorefs = window.document.querySelectorAll(
            'a[role="doc-biblioref"]'
          );
          for (var i = 0; i < bibliorefs.length; i++) {
            const ref = bibliorefs[i];
            const citeInfo = findCites(ref);
            if (citeInfo) {
              tippyHover(citeInfo.el, function () {
                var popup = window.document.createElement("div");
                citeInfo.cites.forEach(function (cite) {
                  var citeDiv = window.document.createElement("div");
                  citeDiv.classList.add("hanging-indent");
                  citeDiv.classList.add("csl-entry");
                  var biblioDiv = window.document.getElementById("ref-" + cite);
                  if (biblioDiv) {
                    citeDiv.innerHTML = biblioDiv.innerHTML;
                  }
                  popup.appendChild(citeDiv);
                });
                return popup.innerHTML;
              });
            }
          }
        });
      </script>
    </div>
    <!-- /content -->
  </body>
</html>
